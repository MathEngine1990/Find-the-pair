<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>Find the Pair</title>
  <!-- ИСПРАВЛЕНО: Более точный viewport для мобильных -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div id="game"></div>

  <!-- Локальный Phaser (важно: до сцен) -->
  <script src="lib/phaser.min.js"></script>

  <!-- Глобальные данные/тема и UI (важно: Buttons.js до сцен) -->
  <script src="ui/Theme.js"></script>
  <script src="game/Data.js"></script>
  <script src="ui/Button.js"></script>

  <!-- Быстрый чек: реально ли загрузился Buttons.js -->
  <script>
    console.log('Buttons loaded?', typeof window.makeImageButton);
    if (typeof window.makeImageButton !== 'function') {
      console.warn('ui/Buttons.js НЕ загрузился — возможно 404/неверный путь. Включаю временный стаб.');
      window.makeImageButton = function(scene,x,y,w,h,label,onClick){
        const t = scene.add.text(x,y,label,{fontFamily:'sans-serif',fontSize:'18px',color:'#fff'}).setOrigin(0.5);
        const z = scene.add.zone(x,y,w,h).setOrigin(0.5).setInteractive({useHandCursor:true});
        z.on('pointerdown',()=>onClick&&onClick());
        const c = scene.add.container(0,0,[t,z]); c.setSize(w,h); return c;
      };
      window.makeIconButton = function(scene,x,y,size,icon,onClick){
        return window.makeImageButton(scene,x,y,size,size,icon,onClick);
      };
    }
  </script>

  <!-- Сцены -->
  <script src="scenes/PreloadScene.js"></script>
  <script src="scenes/MenuScene.js"></script>
  <script src="scenes/GameScene.js"></script>

  <!-- ИСПРАВЛЕНО: Адаптивная инициализация игры -->
  <script>
    // Получаем реальные размеры экрана
    function getGameSize() {
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;
      
      // Минимальные размеры для мобильных
      const minWidth = 360;
      const minHeight = 640;
      
      // Максимальные размеры для десктопа
      const maxWidth = 1920;
      const maxHeight = 1080;
      
      const width = Math.min(Math.max(screenWidth, minWidth), maxWidth);
      const height = Math.min(Math.max(screenHeight, minHeight), maxHeight);
      
      return { width, height };
    }

    const gameSize = getGameSize();
    const DPR = window.devicePixelRatio || 1;
    
    const config = {
      type: Phaser.AUTO,
      parent: 'game',
      backgroundColor: '#000000',
      scale: {
        // ИСПРАВЛЕНО: Используем RESIZE для полной адаптивности
        mode: Phaser.Scale.RESIZE,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        // ИСПРАВЛЕНО: Начальные размеры от реального экрана
        width: gameSize.width,
        height: gameSize.height
      },
      resolution: Math.min(2, DPR), // Ограничиваем DPR для производительности
      render: { 
        antialias: true, 
        pixelArt: false,
        // ИСПРАВЛЕНО: Округление пикселей для четкости
        roundPixels: true
      },
      scene: [ window.PreloadScene, window.MenuScene, window.GameScene ],
      
      // ДОБАВЛЕНО: Настройки для производительности
      physics: {
        default: false // Отключаем физику, она не нужна для карточной игры
      },
      
      // ДОБАВЛЕНО: Дополнительные настройки
      input: {
        // Активная область для touch устройств
        activePointers: 1,
        // Предотвращаем случайные клики
        smoothFactor: 0
      }
    };

    // ДОБАВЛЕНО: Обработчик изменения размеров окна
    window.addEventListener('resize', () => {
      if (window.game && window.game.scale) {
        const newSize = getGameSize();
        window.game.scale.resize(newSize.width, newSize.height);
      }
    });

    // ДОБАВЛЕНО: Обработчик изменения ориентации для мобильных
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        if (window.game && window.game.scale) {
          const newSize = getGameSize();
          window.game.scale.resize(newSize.width, newSize.height);
        }
      }, 100);
    });
  </script>

  <!-- VK bridge подгрузи в main-vk.js, если нужно, но не мешай запуску игры -->
  <!-- <script src="main-vk.js"></script> -->
  <script src="main.js"></script>
</body>
</html>
