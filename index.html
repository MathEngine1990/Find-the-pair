<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ü–∞–º—è—Ç—å: –ù–∞–π–¥–∏ –ø–∞—Ä—É</title>
  <!-- –ö–†–ò–¢–ò–ß–ù–û: viewport –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, minimal-ui, viewport-fit=cover" />
    <!-- –ó–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <!-- –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º -->
    <meta name="mobile-web-app-capable" content="yes" />

  
  <!-- –î–û–ë–ê–í–õ–ï–ù–û: Meta —Ç–µ–≥–∏ –¥–ª—è VK –∏ —Å–æ—Ü—Å–µ—Ç–µ–π -->
  <meta property="og:title" content="–ü–∞–º—è—Ç—å: –ù–∞–π–¥–∏ –ø–∞—Ä—É" />
  <meta property="og:description" content="–¢—Ä–µ–Ω–∏—Ä—É–π—Ç–µ –ø–∞–º—è—Ç—å, –Ω–∞—Ö–æ–¥—è –ø–∞—Ä–Ω—ã–µ –∫–∞—Ä—Ç—ã! –ò–≥—Ä–∞ —Å —Å–∏—Å—Ç–µ–º–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π." />
  <meta property="og:image" content="https://mathengine1990.github.io/Find-the-pair/assets/icon-512.png" />
  <meta property="og:type" content="game" />
  <meta property="og:url" content="https://mathengine1990.github.io/Find-the-pair/" />
  
  <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: VK app_id –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å vk-hosting-config.json -->
  <meta name="vk:app_id" content="53937545" />
  <meta name="theme-color" content="#1d2330" />
  
  <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–±–∏—Ä–∞–µ–º preload –¥–ª—è back_card02.png —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å warning -->
  <link rel="preload" href="lib/phaser.min.js" as="script">
  <link rel="preload" href="ui/Theme.js" as="script">
  <link rel="preload" href="game/Data.js" as="script">
  
  <!-- –î–û–ë–ê–í–õ–ï–ù–û: Favicon –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è 404 –æ—à–∏–±–∫–∏ -->
  <link rel="icon" type="image/png" href="assets/icon-32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="assets/icon-16.png" sizes="16x16">
</head>
<body>
  <!-- –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω fallback –∫–æ–Ω—Ç–µ–Ω—Ç –≤ game div -->
  <div id="game">
    <!-- –ü—Ä–µ–ª–æ–∞–¥–µ—Ä –Ω–∞ —Å–ª—É—á–∞–π –º–µ–¥–ª–µ–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="preloader" style="
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: center; 
      height: 100vh; 
      background: #1d2330; 
      color: #fff; 
      font-family: Arial, sans-serif;
      text-align: center;
    ">
      <div style="
        width: 50px; 
        height: 50px; 
        border: 3px solid #4ECDC4; 
        border-top: 3px solid transparent; 
        border-radius: 50%; 
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      "></div>
      <h2 style="margin: 0 0 10px 0; color: #4ECDC4;">Find the Pair</h2>
      <p style="margin: 0; color: #ccc;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</p>
    </div>
  </div>

  <!-- –î–û–ë–ê–í–õ–ï–ù–û: CSS –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞ –∏ —Å—Ç–∏–ª–µ–π -->
  <style>
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –∫–æ–≥–¥–∞ –∏–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ */
    .game-loaded #preloader {
      display: none !important;
    }
    
    /* –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ game div –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
    #game {
      width: 100vw;
      height: 100vh;
      position: absolute;
      top: 0;
      left: 0;
      overflow: hidden;
    }
    
    /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ */
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #1d2330;
    }
    
    html {
      height: 100%;
      overflow: hidden;
    }
  </style>

  <!-- –õ–æ–∫–∞–ª—å–Ω—ã–π Phaser (–≤–∞–∂–Ω–æ: –¥–æ —Å—Ü–µ–Ω) -->
  <script src="lib/phaser.min.js"></script>

  <!-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ/—Ç–µ–º–∞ –∏ UI (–≤–∞–∂–Ω–æ: Button.js –¥–æ —Å—Ü–µ–Ω) -->
  <script src="ui/Theme.js"></script>
  <script src="game/Data.js"></script>
  <script src="ui/Button.js"></script>

  <script src="sync/ProgressSyncManager.js"></script>

  <!-- –£–õ–£–ß–®–ï–ù–û: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è Button.js —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π -->
  <script>
    console.log('Buttons loaded?', typeof window.makeImageButton);
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    function checkDependencies() {
      const deps = {
        Phaser: typeof window.Phaser !== 'undefined',
        THEME: typeof window.THEME !== 'undefined',
        ALL_CARD_KEYS: Array.isArray(window.ALL_CARD_KEYS),
        LEVELS: Array.isArray(window.LEVELS),
        makeImageButton: typeof window.makeImageButton === 'function'
      };
      
      console.log('Dependencies check:', deps);
      
      const allLoaded = Object.values(deps).every(Boolean);
      if (allLoaded) {
        console.log('‚úÖ All dependencies loaded');
        document.body.classList.add('dependencies-ready');
      } else {
        console.warn('‚ö†Ô∏è Some dependencies missing:', 
          Object.entries(deps).filter(([key, value]) => !value).map(([key]) => key)
        );
      }
      
      return allLoaded;
    }
    
    if (typeof window.makeImageButton !== 'function') {
      console.warn('ui/Button.js –ù–ï –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –≤–∫–ª—é—á–∞—é —É–ª—É—á—à–µ–Ω–Ω—É—é –∑–∞–≥–ª—É—à–∫—É');
      
      // –£–ª—É—á—à–µ–Ω–Ω–∞—è –∑–∞–≥–ª—É—à–∫–∞ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ –∏ —Å—Ç–∏–ª—è–º–∏
      window.makeImageButton = function(scene, x, y, w, h, label, onClick, opts = {}) {
        const container = scene.add.container(x, y);
        
        // –§–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
        const bg = scene.add.graphics()
          .fillGradientStyle(0x2C3E50, 0x2C3E50, 0x34495E, 0x34495E)
          .fillRoundedRect(-w/2, -h/2, w, h, 8)
          .lineStyle(2, 0x3498DB, 0.8)
          .strokeRoundedRect(-w/2, -h/2, w, h, 8);
        
        // –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ —Å —Ç–µ–Ω—å—é
        const text = scene.add.text(0, 0, label, {
          fontFamily: window.THEME?.fontButton || 'Arial, sans-serif',
          fontSize: Math.round(h * (window.THEME?.btnFontFactor || 0.25)) + 'px',
          color: opts.color || window.THEME?.buttonTextColor || '#FFFFFF',
          fontStyle: window.THEME?.buttonStyle || 'bold'
        }).setOrigin(0.5);
        
        // –¢–µ–Ω—å –¥–ª—è —Ç–µ–∫—Å—Ç–∞
        text.setShadow(0, 2, '#000000', 4, false, true);
        
        // –ó–æ–Ω–∞ –∫–ª–∏–∫–∞
        const zone = scene.add.zone(0, 0, w, h)
          .setInteractive({ useHandCursor: true });
        
        container.add([bg, text, zone]);
        container.setSize(w, h);
        
        // –£–õ–£–ß–®–ï–ù–û: –°–æ–±—ã—Ç–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
        zone.on('pointerdown', () => {
          if (onClick) {
            // –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è
            scene.tweens.add({
              targets: container,
              scale: 0.95,
              duration: 100,
              yoyo: true,
              ease: 'Power2'
            });
            onClick();
          }
        });
        
        zone.on('pointerover', () => {
          // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏
          bg.clear()
            .fillGradientStyle(0x34495E, 0x34495E, 0x3C5A78, 0x3C5A78)
            .fillRoundedRect(-w/2, -h/2, w, h, 8)
            .lineStyle(2, 0x52A7F7)
            .strokeRoundedRect(-w/2, -h/2, w, h, 8);
          
          // –ê–Ω–∏–º–∞—Ü–∏—è –º–∞—Å—à—Ç–∞–±–∞
          scene.tweens.add({ 
            targets: container, 
            scale: 1.05, 
            duration: 150,
            ease: 'Power2'
          });
        });
        
        zone.on('pointerout', () => {
          // –í–æ–∑–≤—Ä–∞—Ç –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –≤–∏–¥—É
          bg.clear()
            .fillGradientStyle(0x2C3E50, 0x2C3E50, 0x34495E, 0x34495E)
            .fillRoundedRect(-w/2, -h/2, w, h, 8)
            .lineStyle(2, 0x3498DB, 0.8)
            .strokeRoundedRect(-w/2, -h/2, w, h, 8);
          
          scene.tweens.add({ 
            targets: container, 
            scale: 1.0, 
            duration: 150,
            ease: 'Power2'
          });
        });
        
        // –°–≤–æ–π—Å—Ç–≤–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
        container.zone = zone;
        container.label = text;
        container.bg = bg;
        return container;
      };
      
      window.makeIconButton = function(scene, x, y, size, iconText, onClick, opts = {}) {
        const container = scene.add.container(x, y);
        
        // –ö—Ä—É–≥–ª—ã–π —Ñ–æ–Ω
        const bg = scene.add.graphics()
          .fillStyle(0x2C3E50, 0.8)
          .fillCircle(0, 0, size/2)
          .lineStyle(2, 0x3498DB, 0.6)
          .strokeCircle(0, 0, size/2);
        
        // –ò–∫–æ–Ω–∫–∞
        const icon = scene.add.text(0, 0, iconText, {
          fontFamily: window.THEME?.fontButton || 'Arial, sans-serif',
          fontSize: Math.round(size * (opts.fontFactor || 0.4)) + 'px',
          color: opts.color || window.THEME?.buttonTextColor || '#FFFFFF',
          fontStyle: window.THEME?.buttonStyle || 'bold'
        }).setOrigin(0.5);
        
        // –ó–æ–Ω–∞ –∫–ª–∏–∫–∞
        const zone = scene.add.zone(0, 0, size, size)
          .setInteractive({ useHandCursor: true });
        
        container.add([bg, icon, zone]);
        container.setSize(size, size);
        
        // –°–æ–±—ã—Ç–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
        zone.on('pointerdown', () => {
          if (onClick) {
            scene.tweens.add({
              targets: container,
              scale: 0.9,
              duration: 100,
              yoyo: true,
              ease: 'Power2'
            });
            onClick();
          }
        });
        
        zone.on('pointerover', () => {
          bg.clear()
            .fillStyle(0x34495E, 0.9)
            .fillCircle(0, 0, size/2)
            .lineStyle(2, 0x52A7F7)
            .strokeCircle(0, 0, size/2);
          
          scene.tweens.add({ targets: container, scale: 1.1, duration: 150 });
        });
        
        zone.on('pointerout', () => {
          bg.clear()
            .fillStyle(0x2C3E50, 0.8)
            .fillCircle(0, 0, size/2)
            .lineStyle(2, 0x3498DB, 0.6)
            .strokeCircle(0, 0, size/2);
          
          scene.tweens.add({ targets: container, scale: 1.0, duration: 150 });
        });
        
        container.zone = zone;
        container.label = icon;
        container.bg = bg;
        return container;
      };
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–∂–¥–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
    setTimeout(checkDependencies, 50);
  </script>

  <!-- –°—Ü–µ–Ω—ã -->
  <script src="scenes/PreloadScene.js"></script>
  <script src="scenes/MenuScene.js"></script>
  <script src="scenes/GameScene.js"></script>

  <!-- –°–û–•–†–ê–ù–ï–ù–û: –í–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–≤–µ—Ä—Ö–≤—ã—Å–æ–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è + –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
  <script>
    // –î–û–ë–ê–í–õ–ï–ù–û: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    function checkAllDependencies() {
      const required = [
        { name: 'Phaser', check: () => window.Phaser },
        { name: 'THEME', check: () => window.THEME },
        { name: 'ALL_CARD_KEYS', check: () => window.ALL_CARD_KEYS },
        { name: 'LEVELS', check: () => window.LEVELS },
        { name: 'PreloadScene', check: () => window.PreloadScene },
        { name: 'MenuScene', check: () => window.MenuScene },
        { name: 'GameScene', check: () => window.GameScene }
      ];
      
      const missing = required.filter(dep => !dep.check());
      
      if (missing.length > 0) {
        console.error('‚ùå Missing dependencies:', missing.map(d => d.name));
        return false;
      }
      
      console.log('‚úÖ All dependencies loaded');
      return true;
    }

    // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π DPR –¥–ª—è —É–ª—å—Ç—Ä–∞-—á–µ—Ç–∫–æ—Å—Ç–∏ (–°–û–•–†–ê–ù–ï–ù–û –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞)
    const DPR = window.devicePixelRatio || 1;
    

    
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É
const detectMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
const isLowEnd = navigator.hardwareConcurrency <= 2 || navigator.deviceMemory <= 2;

let baseWidth, baseHeight;

if (detectMobile && isLowEnd) {
  baseWidth = 1080;
  baseHeight = 720;
  console.log('üì± Low-end mobile detected, using standard resolution');
} else if (detectMobile) {
  baseWidth = 1920;
  baseHeight = 1080;
  console.log('üì± Mobile detected, using high resolution');
} else {
  baseWidth = 1920;
  baseHeight = 1080;
  console.log('üñ•Ô∏è Desktop detected, using ultra-high resolution');
}
    
    window.gameConfig = {
      type: Phaser.AUTO,
      parent: 'game',
      backgroundColor: '#1d2330',
      scale: {
        // FIT —Ä–µ–∂–∏–º –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ (–°–û–•–†–ê–ù–ï–ù–û)
        mode: Phaser.Scale.FIT,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —Å –≤–∞—à–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞
        width: baseWidth,
        height: baseHeight
      },
      resolution: DPR,
      render: { 
        antialias: true, 
        pixelArt: false,
        roundPixels: false, // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —á–µ—Ç–∫–æ—Å—Ç—å (–°–û–•–†–ê–ù–ï–ù–û)
        powerPreference: 'high-performance',
        // –°–û–•–†–ê–ù–ï–ù–û: –í–∞—à–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
        premultipliedAlpha: true,
        transparent: false,
        clearBeforeRender: true,
        // –î–û–ë–ê–í–õ–ï–ù–û: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        batchSize: 4096,
        maxTextures: 16
      },
      scene: [ window.PreloadScene, window.MenuScene, window.GameScene ],
      physics: {
        default: false // –°–û–•–†–ê–ù–ï–ù–û: –û—Ç–∫–ª—é—á–µ–Ω–∞ —Ñ–∏–∑–∏–∫–∞
      },
      input: {
        activePointers: 1,
        smoothFactor: 0.1 // –°–û–•–†–ê–ù–ï–ù–û: –°–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
      },
      // –î–û–ë–ê–í–õ–ï–ù–û: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
      fps: {
        target: 60,
        forceSetTimeOut: true,
        deltaHistory: 10
      },
      // –î–û–ë–ê–í–õ–ï–ù–û: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å VK
      callbacks: {
        preBoot: function(game) {
          console.log('üöÄ Game pre-boot');
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
          if (!checkAllDependencies()) {
            throw new Error('Missing required dependencies');
          }
        },
        
        postBoot: function(game) {
          console.log('‚úÖ Game booted successfully', {
            renderer: game.renderer.type === 0 ? 'Canvas' : 'WebGL',
            resolution: DPR,
            size: `${game.scale.width}x${game.scale.height}`,
            deviceRatio: window.devicePixelRatio,
            mobile: detectMobile,
            lowEnd: isLowEnd
          });
          
          // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–±–∏—Ä–∞–µ–º –ø—Ä–µ–ª–æ–∞–¥–µ—Ä –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
          hidePreloader();
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∏–≥—Ä—É –≥–ª–æ–±–∞–ª—å–Ω–æ
          window.game = game;
          
          // –î–û–ë–ê–í–õ–ï–ù–û: –ü–µ—Ä–µ–¥–∞—á–∞ VK –¥–∞–Ω–Ω—ã—Ö –≤ –∏–≥—Ä—É
          if (window.VK_USER_DATA) {
            game.registry.set('vkUserData', window.VK_USER_DATA);
          }
          if (window.VK_LAUNCH_PARAMS) {
            game.registry.set('vkLaunchParams', window.VK_LAUNCH_PARAMS);
          }
          
          // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –æ—à–∏–±–æ–∫
          game.events.on('pause', () => console.log('‚è∏Ô∏è Game paused'));
          game.events.on('resume', () => console.log('‚ñ∂Ô∏è Game resumed'));
          
          // –î–û–ë–ê–í–õ–ï–ù–û: –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          if (window.location.search.includes('debug=1')) {
            console.log('üîß Debug mode enabled');
            window.debugGameConfig = {
              config: game.config,
              renderer: game.renderer,
              textures: game.textures,
              scale: game.scale
            };
          }
        }
      }
    };

    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–∞
    function hidePreloader() {
      const preloader = document.getElementById('preloader');
      if (preloader) {
        preloader.style.display = 'none';
        document.body.classList.add('game-loaded');
        console.log('‚úÖ Preloader hidden, game ready');
      }
    }
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    window.addEventListener('error', (event) => {
      console.error('üö® JavaScript Error:', {
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        error: event.error
      });
      
      // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ appendChild
      if (event.message && 
          event.message.includes('appendChild') && 
          !window.game) {
        
        console.log('üîß Attempting to fix appendChild error...');
        
        // –û—á–∏—â–∞–µ–º –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º game –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const gameDiv = document.getElementById('game');
        if (gameDiv) {
          gameDiv.innerHTML = `
            <div style="
              display: flex; 
              flex-direction: column; 
              justify-content: center; 
              align-items: center; 
              height: 100vh; 
              background: #1d2330; 
              color: #fff; 
              font-family: Arial, sans-serif;
              text-align: center;
              padding: 20px;
            ">
              <h2>üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏...</h2>
              <p>–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã</p>
              <div style="
                width: 30px; 
                height: 30px; 
                border: 2px solid #4ECDC4; 
                border-top: 2px solid transparent; 
                border-radius: 50%; 
                animation: spin 1s linear infinite;
                margin-top: 15px;
              "></div>
            </div>
          `;
          
          // –ü—ã—Ç–∞–µ–º—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–≥—Ä—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            location.reload();
          }, 2000);
        }
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ—à–∏–±–∫—É —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
      if (event.message && 
          (event.message.includes('Phaser') || 
           event.message.includes('WebGL') ||
           event.message.includes('dependencies'))) {
        
        const gameDiv = document.getElementById('game');
        if (gameDiv && !window.game) {
          gameDiv.innerHTML = `
            <div style="
              display: flex; 
              flex-direction: column; 
              justify-content: center; 
              align-items: center; 
              height: 100vh; 
              background: #1d2330; 
              color: #fff; 
              font-family: Arial, sans-serif;
              text-align: center;
              padding: 20px;
            ">
              <h2>üòî –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã</h2>
              <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
              <button onclick="location.reload()" style="
                padding: 12px 24px; 
                font-size: 16px; 
                background: #3498db; 
                color: white; 
                border: none; 
                border-radius: 8px; 
                cursor: pointer;
                margin-top: 20px;
                font-weight: bold;
              ">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</button>
              <div style="
                margin-top: 20px; 
                font-size: 12px; 
                opacity: 0.7;
                max-width: 400px;
              ">
                –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É –≤ –¥—Ä—É–≥–æ–º –±—Ä–∞—É–∑–µ—Ä–µ
              </div>
            </div>
          `;
        }
      }
    });

    // –î–û–ë–ê–í–õ–ï–ù–û: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    if (isMobile) {
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
      document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
          e.preventDefault();
        }
      }, { passive: false });
      
      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–≤–æ–π–Ω–æ–µ –∫–∞—Å–∞–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
      let lastTouchEnd = 0;
      document.addEventListener('touchend', function(e) {
        const now = (new Date()).getTime();
        if (now - lastTouchEnd <= 300) {
          e.preventDefault();
        }
        lastTouchEnd = now;
      }, { passive: false });

      // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
      document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
      });

      // –°–∫—Ä—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É –Ω–∞ iOS
      if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
        setTimeout(() => {
          window.scrollTo(0, 1);
        }, 100);
      }
      
      console.log('üì± Mobile optimizations applied');
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –£–ª—É—á—à–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–ª–æ–∞–¥–µ—Ä–æ–º
    let gameCheckInterval = setInterval(() => {
      if (window.game && window.game.scene && window.game.scene.scenes.length > 0) {
        hidePreloader();
        clearInterval(gameCheckInterval);
      }
    }, 100);

    // –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –°–æ–∫—Ä–∞—â–µ–Ω timeout –¥–æ 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫—Ä—ã—Ç–∏—è
    setTimeout(() => {
      if (document.getElementById('preloader')) {
        console.log('‚úÖ Game loaded, hiding preloader');
        hidePreloader();
      }
      clearInterval(gameCheckInterval);
    }, 5000); // –£–º–µ–Ω—å—à–µ–Ω–æ —Å 10 –¥–æ 5 —Å–µ–∫—É–Ω–¥
  </script>

  <!-- –ò–°–ü–†–ê–í–õ–ï–ù–û: main.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ -->
  <script src="main.js"></script>
  
  <!-- –î–û–ë–ê–í–õ–ï–ù–û: –§–∏–Ω–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π -->
  <script>
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞ —ç–∫—Ä–∞–Ω–∞
    window.addEventListener('orientationchange', () => {
      setTimeout(() => {
        if (window.game && window.game.scale) {
          window.game.scale.refresh();
          console.log('üîÑ Screen orientation changed, game refreshed');
        }
      }, 500);
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
    window.addEventListener('resize', () => {
      if (window.game && window.game.scale) {
        clearTimeout(window.resizeTimeout);
        window.resizeTimeout = setTimeout(() => {
          window.game.scale.refresh();
          console.log('üîÑ Window resized, game refreshed');
        }, 250);
      }
    });
    
    // –î–û–ë–ê–í–õ–ï–ù–û: –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('beforeunload', () => {
      console.log('üîÑ Page unloading, cleaning up...');
      if (window.game) {
        try {
          window.game.destroy(true);
          window.game = null;
        } catch (e) {
          console.warn('Cleanup warning:', e);
        }
      }
    });

    // –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    window.addEventListener('load', () => {
      console.log('üìÑ Page fully loaded');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–ª–∞—Å—å
      setTimeout(() => {
        if (!window.game) {
          console.warn('‚ö†Ô∏è Game not created after page load - showing error');
          const gameDiv = document.getElementById('game');
          if (gameDiv) {
            gameDiv.innerHTML = `
              <div style="
                display: flex; 
                flex-direction: column; 
                justify-content: center; 
                align-items: center; 
                height: 100vh; 
                background: #1d2330; 
                color: #fff; 
                font-family: Arial, sans-serif;
                text-align: center;
                padding: 20px;
              ">
                <h2>‚ö†Ô∏è –ò–≥—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å</h2>
                <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</p>
                <button onclick="location.reload()" style="
                  padding: 12px 24px; 
                  font-size: 16px; 
                  background: #e74c3c; 
                  color: white; 
                  border: none; 
                  border-radius: 8px; 
                  cursor: pointer;
                  margin-top: 20px;
                  font-weight: bold;
                ">üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
              </div>
            `;
          }
        }
      }, 3000);
    });
  </script>
  <!-- VK Bridge -->
<script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK Bridge
  if (window.vkBridge) {
    vkBridge.send('VKWebAppInit');
    window.VK_BRIDGE_READY = true;
  }
</script>

</body>
</html>
